!function e(t,o,r){function i(s,a){if(!o[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(n)return n(s,!0);var p=new Error("Cannot find module '"+s+"'");throw p.code="MODULE_NOT_FOUND",p}var d=o[s]={exports:{}};t[s][0].call(d.exports,function(e){var o=t[s][1][e];return i(o?o:e)},d,d.exports,e,t,o,r)}return o[s].exports}for(var n="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,o){"use strict";var r=function(){function e(){if(this.divContainerId="divSpPropertyBag",this.divBlockContainerId="divBlockSpPropertyBag",this.reloadRequired=!1,this.refreshTableRequired=!1,this.ctx=SP.ClientContext.get_current(),this.web=this.ctx.get_web(),"function"!=typeof this.web.doesUserHavePermissions)return void this.showMessageOnDialog("Unable to check permissions","Cannot check permissions against a non-securable object.");var e=new SP.BasePermissions;e.set(SP.PermissionKind.manageWeb),this.per=this.web.doesUserHavePermissions(e);var t=Function.createDelegate(this,function(e,t){var o=this.per.get_value();o?this.getWebProperties():this.showMessageOnDialog("No required permissions","Current user does not have the required permissions")}),o=Function.createDelegate(this,this.notificatioError);this.ctx.executeQueryAsync(t,o)}return e.prototype.modalError=function(e,t){alert("Failed to execute the action... Check the console log."),console.log(t.get_message()),this.toggleBlockModal(!1)},e.prototype.notificatioError=function(e,t){SP.UI.Notify.addNotification("Failed to get web properties...<br>"+t.get_message(),!1)},e.prototype.getWebProperties=function(){this.ctx=SP.ClientContext.get_current(),this.web=this.ctx.get_web(),this.allProperties=this.web.get_allProperties(),this.ctx.load(this.web),this.ctx.load(this.allProperties);var e=Function.createDelegate(this,function(e,t){this.showPropertiesDialog(this.allProperties.get_fieldValues())}),t=Function.createDelegate(this,this.modalError);this.ctx.executeQueryAsync(e,t)},e.prototype.toggleBlockModal=function(e){var t=document.getElementById(this.divBlockContainerId);t.style.display=e?"block":"none"},e.prototype.refreshAllPropertiesTable=function(){this.ctx=SP.ClientContext.get_current(),this.web=this.ctx.get_web(),this.allProperties=this.web.get_allProperties(),this.ctx.load(this.web),this.ctx.load(this.allProperties);var e=Function.createDelegate(this,function(e,t){this.refreshTableRequired=!1;var o=this.allProperties.get_fieldValues(),r=this.getItemArray(o),i=document.getElementById(this.divContainerId);i.innerHTML=this.buildTable(r),this.toggleBlockModal(!1)}),t=Function.createDelegate(this,this.modalError);this.ctx.executeQueryAsync(e,t)},e.prototype.buildTable=function(e){for(var t=['<hr><table style="margin: 1em;">'],o=0,r=e.length;o<r;o++){var i=e[o];t.push("<tr>"),t.push('<td style="text-align: right; padding-top: 15px;"><b>'+i.prop+"</b></td>"),t.push('<td style="padding-top: 15px;"><input id="prop'+o+'" style="width:240px; " type="text" value="'+i.value+'"></inpu></td>'),t.push('<td style="padding-top: 15px;"><button onclick="window.SpPropertyBagObj.setProperty(\''+i.prop+"','prop"+o+"'); return false;\">Update</button></td>"),t.push('<td style="padding-top: 15px;"><button style="color: red; min-width: 1em;" onclick="window.SpPropertyBagObj.deleteProperty(\''+i.prop+"','prop"+o+"'); return false;\">X</button></td>"),t.push("</tr>")}return t.push("</table>"),t.push("<hr><h3>Add a new property:</h3>"),t.push('<div style="margin: 1em; padding-bottom: 2em;">Key: <input id="newKey"></inpu>'),t.push('&nbsp;&nbsp;&nbsp;Value: <input id="newValue"></inpu>'),t.push('&nbsp;<button onclick="window.SpPropertyBagObj.addProperty(); return false;">Add</button></div>'),t.push("<div></div>"),t.push('<div id="'+this.divBlockContainerId+'" style="display:none; position: absolute; width: 100%; height: 100%; background-color: gray; top: 0; left: 0;opacity: .8;"></div>'),t.join("\n")},e.prototype.executeChanges=function(){this.ctx.get_web().update();var e=Function.createDelegate(this,function(e,t){console.log("Web properties successfully modified"),this.reloadRequired?window.location.reload():this.refreshTableRequired?this.refreshAllPropertiesTable():this.toggleBlockModal(!1)}),t=Function.createDelegate(this,this.modalError);this.ctx.executeQueryAsync(e,t)},e.prototype.setProperty=function(e,t){this.toggleBlockModal(!0);var o=document.getElementById(t).value;this.allProperties.set_item(e,o),this.executeChanges()},e.prototype.deleteProperty=function(e,t){if(confirm("Are you sure you want to remove this property? The page will be refreshed after the property has been deleted.")){this.toggleBlockModal(!0);var o=document.getElementById(t).parentNode.parentNode;o.parentNode.removeChild(o),this.allProperties.set_item(e),this.executeChanges(),this.reloadRequired=!0}},e.prototype.addProperty=function(){this.toggleBlockModal(!0),this.refreshTableRequired=!0;var e=document.getElementById("newKey").value,t=document.getElementById("newValue").value;document.getElementById("newValue").value="",document.getElementById("newKey").value="",this.allProperties.set_item(e,t),this.executeChanges()},e.prototype.getItemArray=function(e){var t,o,r=[];for(t in e)e.hasOwnProperty(t)&&(o=typeof e[t],"string"===o&&r.push({prop:t,value:e[t].replace(/"/g,"&quot;")}));return r.sort(function(e,t){return e.prop.localeCompare(t.prop)}),r},e.prototype.showModal=function(e,t){SP.UI.ModalDialog.showModalDialog({title:e,html:t,showClose:!0,autoSize:!0,dialogReturnValueCallback:function(e){this.reloadRequired&&window.location.reload()}})},e.prototype.showMessageOnDialog=function(e,t){var o=document.createElement("div"),r=document.createElement("hr"),i=document.createElement("p");o.id=this.divContainerId,i.textContent=t,o.appendChild(r),o.appendChild(i),this.showModal(e,o)},e.prototype.showPropertiesDialog=function(e){var t=this.getItemArray(e),o=document.createElement("div");o.id=this.divContainerId,o.innerHTML=this.buildTable(t),this.showModal("Property Bag Editor",o)},e}();o.SpPropertyBag=r},{}],2:[function(e,t,o){"use strict";var r=e("./SpPropertyBag");SP.SOD.executeFunc("sp.js","SP.ClientContext",function(){window.SpPropertyBagObj=new r.SpPropertyBag})},{"./SpPropertyBag":1}]},{},[2]);
//# sourceMappingURL=SpPropertyBag.js.map
